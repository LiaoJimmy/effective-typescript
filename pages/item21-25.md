---
transition: fade-out
layout: side-title
side: l
color: pink-light
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 21

:: content ::

<v-click>
<h1> Understand How a Variable Gets Its Type </h1>

```ts {monaco}
interface Vector3 {
  x: number;
  y: number;
  z: number;
}
function getVector(vector: Vector3, axis: 'x' | 'y' | 'z') {
  return vector[axis];
}

let x = 'x';
let vector = {x: 10, y: 20, z: 30};
getVector(vector, x);

```
</v-click>

<v-click>
<br>
If you declare a variable with const instead of let, it gets a narrowest type.
</v-click>

---
transition: fade-out
layout: side-title
side: l
color: pink-light
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 21

:: content ::

# as const
When you write as const after a value, TypeScript will infer the narrowest possible type for it.

```ts {monaco}
const obj1 = { x: 1, y: 2 };

const obj2 = { x: 1 as const, y: 2 };

const obj3 = { x: 1, y: 2 } as const;

```

<v-click>
<br>
<b>Question: Nested as const</b>
```ts {monaco}
const obj4 = { x: 1, y: 2, nested: { z: 3 } } as const;
```
</v-click>

---
transition: fade-out
layout: side-title
side: l
color: pink-light
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 21

:: content ::

# Object.freeze()
Object.freeze has introduced some readonly modifiers into the inferred types

```ts {monaco}
const frozenArray = Object.freeze([1, 2, 3]);

const frozenObj = Object.freeze({ x: 1, y: 2 });

```

<v-click>
<br>
<b>Question: Nested Object.freeze()</b>
```ts {monaco}
const forzeonNestedObj = Object.freeze({ x: 1, y: 2, nested: { z: 3 }});
forzeonNestedObj.nested.z;
```
</v-click>

---
transition: fade-out
layout: side-title
side: l
color: pink-light
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 21

:: content ::

# satisfies
Satisfies operator ensures that a value, well, satisfies the requirements of a type and guides inference by preventing TypeScript from inferring a wider type.

```ts {monaco}
type Point = [number, number];

const capitalsBad = {
    ny: [-73.7562, 42.6526,],
    ca: [-121.4944, 38.5816],
} satisfies Record<string, Point>;

capitalsBad.ny;
```

---
transition: fade-out
layout: side-title
side: l
color: pink-light
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 21

:: content ::

# Satisfies operator in Storybook
Better in-editor type checking for <a href="https://storybook.js.org/blog/improved-type-safety-in-storybook-7/" target="_blank">Component Story Format 3</a>


```ts {monaco}
import type { Meta } from '@storybook/react';

const meta = {
  title: 'Components/Toast',
  tags: ['autodocs'],
} satisfies Meta;
```

---
transition: fade-out
layout: side-title
side: l
color: sky-light
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 22

:: content ::

# Use in keyword to narrow

```ts {monaco}
interface Apple { isGoodForBaking: boolean; }
interface Orange { numSlices: number; }

function pickFruit(fruit: Apple | Orange) {
  if ('isGoodForBaking' in fruit) {
    fruit
  } else {
    fruit
  }
  fruit
}
```

---
transition: fade-out
layout: side-title
side: l
color: sky-light
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 22

:: content ::

# null is object

```ts {monaco}
const elem = document.getElementById('what-time-is-it');
if (typeof elem === 'object') {
  elem;
}

```

---
transition: fade-out
layout: side-title
side: l
color: sky-light
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 22

:: content ::

# Why object is null?

<v-click>
The type tags were stored in the lower bits of the units. There were five of them:

- 000: object. The data is a reference to an object.
- 001: int. The data is a 31 bit signed integer.
- 010: double. The data is a reference to a double floating point number.
- 100: string. The data is a reference to a string.
- 110: boolean. The data is a boolean.
</v-click>

<v-click>
null (JSVAL_NULL) was the machine code NULL pointer. Or: an object type tag plus a reference that is zero.
It canâ€™t be fixed because it would break the existing code.
</v-click>

---
transition: fade-out
layout: quote
color: sky-light
quotesize: text-m
authorsize: text-s
author: 'Hyrum''s Law'

---
"With a sufficient number of users of an API,
it does not matter what you promise in the contract:
all observable behaviors of your system
will be depended on by somebody."

---
transition: fade-out
layout: side-title
side: l
color: sky-light
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 22

:: content ::

# Falsy primitive values

```ts {monaco}
function maybeLogX(x?: number | string | null) {
  if (!x) {
    x
  }
}

```

---
transition: fade-out
layout: side-title
side: l
color: sky-light
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 22

:: content ::

# Discriminated union

```ts {monaco}
type NetworkLoadingState = {
  state: 'loading';
};
type NetworkFailedState = {
  state: 'failed';
  code: number;
};
type NetworkSuccessState = {
  state: 'success';
  response: {
    title: string;
    duration: number;
    summary: string;
  };
};
type NetworkState =
  | NetworkLoadingState
  | NetworkFailedState
  | NetworkSuccessState;

function checkNetwork (network: NetworkState){
  if (network.state === 'loading') {
    network
  }
}

```

---
transition: fade-out
layout: side-title
side: l
color: sky-light
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 22

:: content ::

# User-defined type guard

```ts {monaco}
function isInputElement(element: Element): element is HTMLInputElement {
  return 'value' in element;
}

function getElementContent(element: HTMLElement) {
  if (isInputElement(element)) {
    return element.value;
  }
  return element.textContent;
}

const formElements = document.querySelectorAll('.register-form *');
const formInputElements = [...formElements].filter(isInputElement);
```

---
transition: fade-out
layout: side-title
side: l
color: yellow-light
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 23

:: content ::

# Create Objects All at Once

```ts {monaco}
const point = {};
point.x = 3;
point.y = 4;
```

<v-click>
<br>
Object spread syntax to build up objects field by field in a type-safe way.
```ts {monaco}
interface Point { x: number, y: number }
const point: Point = {
  x: 3,
  y: 4
};
```
</v-click>

---
transition: fade-out
layout: side-title
side: l
color: yellow-light
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 23

:: content ::

# Conditionally add a property in a type-safe way

```ts {monaco}
const getPresidentName = (hasMiddle = true) => {
  const firstLast = { first: 'Harry', last: 'Truman' };
  const president = {
    ...firstLast,
    ...(hasMiddle ? { middle: 'S' } : {})
  };
  return president;
}
```

---
transition: fade-out
layout: side-title
side: l
color: violet
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 24

:: content ::

# Aliasing can prevent TypeScript from narrowing types.

```ts {monaco}
interface Coordinate {
  x: number;
  y: number;
}

interface BoundingBox {
  x: [number, number];
  y: [number, number];
}

interface Polygon {
  boundingBox?: BoundingBox;
}

function isPointInPolygon(polygon: Polygon, pt: Coordinate) {
  const box = polygon.boundingBox;
  if (polygon.boundingBox) {
    if (pt.x < box.x[0] || pt.x > box.x[1] ||
        pt.y < box.y[0] || pt.y > box.y[1]) {
      return false;
    }
  }
}

```

---
transition: fade-out
layout: side-title
side: l
color: violet
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 25

:: content ::

# Prefer async/await to raw Promises
It enforces that async functions always return Promises.

```ts {monaco}
async function fetchPages() {
  try {
    const response1 = await fetch('url1');
    const response2 = await fetch('url2');
    // ...
  } catch (error) {
    // ...
  }
}
```

<v-click>
<br>
<b> Question: what's the type of fetchPages()</b>
```ts {monaco}
function fetchPages() {
  fetch('url1').then(response1 => {
    return fetch('url2');
  }).catch(error => {
  
  })
}
```
</v-click>

---
transition: fade-out
layout: side-title
side: l
color: violet
titlewidth: is-4
align: rm-lm

---
:: title ::

# Item 25

:: content ::

# Top level await

<v-click>
You can use the await keyword on its own (outside of an async function) at the top level of a module.
```ts {monaco}
function findAnswer() {
  return new Promise((resolve, reject) => {
    resolve('answer');
  });
}

await findAnswer();
```
</v-click>